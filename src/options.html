<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Gradescope Calendar Sync - Settings</title>
    <link rel="stylesheet" href="options.css">
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="optionsThemeToggle" aria-label="Toggle dark mode" title="Toggle dark mode">
        <svg class="theme-icon theme-icon-moon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
        <svg class="theme-icon theme-icon-sun" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
    </button>

    <div class="header">
        <h1>Gradescope to Cal - Settings</h1>
        <p>Automatically sync your Gradescope assignments to Google Calendar</p>
    </div>

    <!-- Authentication Section -->
    <div class="section">
        <h2>🔑 Google Calendar Authentication</h2>

        <div id="authStatus" class="status info">
            <div>Checking authentication status...</div>
        </div>

        <div id="authControls" style="text-align: center;">
            <button id="authenticate" class="button success">
                Connect Google Calendar
            </button>

            <button id="disconnect" class="button danger" style="display: none;">
                Disconnect
            </button>
        </div>

        <div class="info-box">
            <strong>Privacy Note:</strong> Your Google account authentication is stored locally in your browser.
            No data is sent to external servers - all processing happens locally in your browser extension.
        </div>
    </div>

    <!-- Enhanced Auto-Sync Settings Section -->
    <div class="section">
        <h2>🔄 Smart Auto-Sync Settings</h2>

        <div class="enhanced-feature">
            <h4>🎯 Optimized Daily Sync <span class="feature-badge">Enhanced</span></h4>
            <p>Automatically syncs new assignments to your calendar once every 24 hours. This timing is optimized based on typical assignment posting patterns.</p>
        </div>

        <div class="setting-item">
            <div>
                <label for="autoSync">Enable automatic background sync</label>
                <div class="setting-description">
                    Runs daily sync in the background - no manual intervention needed
                </div>
            </div>
            <input type="checkbox" id="autoSync" checked>
        </div>

        <!-- Event Color Picker (Collapsible) -->
        <details class="event-appearance-section">
            <summary class="event-appearance-summary">
                <div class="summary-content">
                    <h4 style="margin: 0;">🎨 Event Appearance</h4>
                    <p style="margin: 4px 0 0 0; font-size: 13px; color: var(--text-secondary);">
                        Customize colors, reminders, and display settings
                    </p>
                </div>
                <div class="summary-icon">▼</div>
            </summary>

            <div class="event-appearance-content">
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
                    Choose the color for assignment events in your Google Calendar
                </p>

                <div class="color-picker-grid" id="colorPickerGrid">
                    <!-- Color 1: Lavender -->
                    <div class="color-box" data-color-id="1" data-color-name="Lavender" style="background-color: #a4bdfc;" title="Lavender">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 2: Sage -->
                    <div class="color-box" data-color-id="2" data-color-name="Sage" style="background-color: #7ae7bf;" title="Sage">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 3: Grape -->
                    <div class="color-box" data-color-id="3" data-color-name="Grape" style="background-color: #dbadff;" title="Grape">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 4: Flamingo -->
                    <div class="color-box" data-color-id="4" data-color-name="Flamingo" style="background-color: #ff887c;" title="Flamingo">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 5: Banana -->
                    <div class="color-box" data-color-id="5" data-color-name="Banana" style="background-color: #fbd75b;" title="Banana">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 6: Tangerine -->
                    <div class="color-box" data-color-id="6" data-color-name="Tangerine" style="background-color: #ffb878;" title="Tangerine">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 7: Peacock -->
                    <div class="color-box" data-color-id="7" data-color-name="Peacock" style="background-color: #46d6db;" title="Peacock">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 8: Graphite -->
                    <div class="color-box" data-color-id="8" data-color-name="Graphite" style="background-color: #e1e1e1;" title="Graphite">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 9: Blueberry (Default) -->
                    <div class="color-box selected" data-color-id="9" data-color-name="Blueberry" style="background-color: #5484ed;" title="Blueberry (Default)">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 10: Basil -->
                    <div class="color-box" data-color-id="10" data-color-name="Basil" style="background-color: #51b749;" title="Basil">
                        <span class="color-checkmark">✓</span>
                    </div>
                    <!-- Color 11: Tomato -->
                    <div class="color-box" data-color-id="11" data-color-name="Tomato" style="background-color: #dc2127;" title="Tomato">
                        <span class="color-checkmark">✓</span>
                    </div>
                </div>

                <div id="colorSelectionStatus" class="setting-description" style="text-align: center; margin-top: 10px; font-weight: 500;">
                    Selected: <span id="selectedColorName">Blueberry</span>
                </div>

                <!-- Reminder Schedule Section -->
                <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <h5 style="margin: 0 0 12px 0; font-size: 14px; font-weight: 600; color: var(--text-primary);">
                        🔔 Reminder Schedule
                    </h5>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
                        Choose when to receive notifications before assignment deadlines
                    </p>

                    <div class="reminder-options">
                        <label class="radio-option">
                            <input type="radio" name="reminderSchedule" value="none">
                            <span class="radio-label">None</span>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="reminderSchedule" value="single">
                            <span class="radio-label">Single reminder (1 day before)</span>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="reminderSchedule" value="double" checked>
                            <span class="radio-label">Double reminder (1 day + 1 hour before)</span>
                            <span class="radio-badge">Default</span>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="reminderSchedule" value="custom">
                            <span class="radio-label">Custom</span>
                        </label>
                    </div>

                    <!-- Custom Reminder Builder (inline toggle) -->
                    <div id="customReminderBuilder" class="custom-reminder-builder" style="display: none;">
                        <div class="custom-reminder-list" id="customReminderList">
                            <!-- Custom reminder rows will be added here dynamically -->
                        </div>
                        <button type="button" id="addReminderBtn" class="add-reminder-btn">
                            + Add reminder
                        </button>
                        <p class="setting-description" style="margin-top: 8px; font-size: 12px;">
                            Maximum 3 reminders
                        </p>
                    </div>
                </div>

                <!-- Assignment Display Timing Section -->
                <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <h5 style="margin: 0 0 12px 0; font-size: 14px; font-weight: 600; color: var(--text-primary);">
                        📅 Assignment Display Timing
                    </h5>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
                        Choose how assignments appear in your calendar
                    </p>

                    <div class="display-timing-options">
                        <label class="radio-option">
                            <input type="radio" name="eventDisplayTime" value="deadline" checked>
                            <div class="radio-content">
                                <span class="radio-label">Show at deadline time</span>
                                <span class="radio-badge">Default</span>
                            </div>
                        </label>

                        <label class="radio-option">
                            <input type="radio" name="eventDisplayTime" value="allday">
                            <div class="radio-content">
                                <span class="radio-label">Show as all-day event</span>
                                <span class="radio-helper-text warning-text">⚠️ Only supports day-of reminders, not time-specific alerts</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </details>

        <button id="saveSettings" class="button">Save Settings</button>
    </div>

    <!-- Data Management Section -->
    <div class="section">
        <h2>📊 Data Management</h2>

        <p>Manage your locally stored assignment data and extension settings.</p>

        <button id="clearAssignments" class="button">Clear Assignment Data</button>
        <button id="clearAuth" class="button danger">Clear Authentication</button>
        <button id="clearAll" class="button danger">Clear All Data</button>
        <button id="showStats" class="button secondary">View Data Statistics</button>

        <div class="info-box">
            <strong>Data Storage:</strong> All your data is stored locally in your browser.
            Assignment data includes: titles, due dates, course names, and Gradescope URLs.
        </div>
    </div>

    <!-- Privacy Information -->
    <div class="section">
        <details class="privacy-collapsible-section">
            <summary class="privacy-collapsible-summary">
                <div class="summary-content">
                    <h2 style="margin: 0;">🔒 Privacy & Security</h2>
                    <p style="margin: 4px 0 0 0; font-size: 13px; color: var(--text-secondary);">
                        Learn about our zero-server architecture and security practices
                    </p>
                </div>
                <div class="summary-icon">▼</div>
            </summary>

            <div class="privacy-collapsible-content">
                <p><strong>Zero-server architecture:</strong> This extension processes everything locally in your browser.
                No assignment data, personal information, or authentication tokens are ever sent to external servers.</p>

                <p><strong>Data collection:</strong> We collect zero user data. The extension only stores:</p>
                <ul>
                    <li>Assignment information you choose to extract from Gradescope</li>
                    <li>Your Google Calendar authentication tokens (stored securely in browser)</li>
                    <li>Your sync preferences and settings</li>
                </ul>

                <p><strong>Permissions explained:</strong> This extension only requests the minimum permissions needed:</p>
                <ul>
                    <li><code>storage</code> - Store your settings and extracted assignments locally</li>
                    <li><code>identity</code> - Handle Google OAuth authentication securely</li>
                    <li><code>alarms</code> - Schedule daily background sync operations</li>
                    <li><code>scripting</code> - Extract assignment data from Gradescope pages you visit</li>
                    <li><code>*.gradescope.com</code> - Access Gradescope pages for assignment extraction</li>
                    <li><code>*.googleapis.com</code> - Direct communication with Google Calendar API</li>
                </ul>

                <div style="margin-top: 20px; padding: 15px; background: rgba(72, 187, 120, 0.1); border-radius: 6px;">
                    <strong>🛡️ Enhanced Security Features:</strong>
                    <ul style="margin: 10px 0;">
                        <li>Dual OAuth client support for optimal browser compatibility</li>
                        <li>Automatic token refresh and secure credential management</li>
                        <li>Rate-limited API calls to respect service quotas</li>
                        <li>Smart caching to minimize unnecessary network requests</li>
                    </ul>
                </div>
            </div>
        </details>
    </div>
    </div>

    <!-- Load WebExtension Polyfill for cross-browser compatibility -->
    <script src="lib/browser-polyfill.js"></script>

    <!-- Load modules (calendar functionality only - no grade modules) -->
    <script src="utils/feedbackBanner.js"></script>
    <script src="options/options-theme.js"></script>
    <script src="options/options-settings.js"></script>
    <script src="options/options-pin-prompt.js"></script>
    <script src="options/options-main.js"></script>

    <!-- Help & Feedback Section -->
    <div class="section">
        <h2>📧 Help & Feedback</h2>
        <p>Questions? Bugs? Feature requests? I'd love to hear from you!</p>
        <div class="info-box">
            <strong>Email:</strong> <a href="mailto:gradescope.to.cal@gmail.com" class="contact-link">gradescope.to.cal@gmail.com</a><br>
            <strong>GitHub Issues:</strong> <a href="https://github.com/Matut-E/gradescope-to-Cal/issues" target="_blank" class="contact-link">Report a bug or request a feature</a>
        </div>
    </div>

    </body>
</html>
